<!DOCTYPE html>
<html>
<head>
    <title>Mental Health Prediction Survey</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        .container {
            width: 80%;
            max-width: 600px;
            background: #fff;
            margin: 30px auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            text-align: center;
        }
        .form-step {
            display: none;
        }
        .form-step.active {
            display: block;
        }
        button {
            background: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background: #0056b3;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 8px;
        }
        select, input[type="number"] {
            width: 100%;
            padding: 8px;
        }
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
        }
        #result {
            text-align: center;
            font-size: 1.2em;
            color: green;
            margin-top: 20px;
        }
    </style>
</head>
<body>

  <h2>Mental Health Prediction Survey</h2>

  <form id="predictionForm">
    <!-- Age -->
    <div class="question active">
      <label>Age: <input type="number" name="age" min="10" max="100" required></label>
    </div>

    <!-- Gender -->
    <div class="question">
      <label>Gender:
        <select name="gender" required>
          <option value="0">Male</option>
          <option value="1">Female</option>
          <option value="2">Transgender</option>
          <option value="3">Non Binary</option>
        </select>
      </label>
    </div>

    <!-- Country -->
    <div class="question">
      <label>Country: 
        <select name="country" >
          <option>United States</option>
          <option>Canada</option>
          <option>United Kingdom</option>
          <option>Bulgaria</option>
          <option>France</option>
          <option>Portugal</option>
          <option>Netherlands</option>
          <option>Switzerland</option>
          <option>Poland</option>
          <option>Australia</option>
          <option>Germany</option>
          <option>Russia</option>
          <option>Mexico</option>
          <option>Brazil</option>
          <option>Slovenia</option>
          <option>Costa Rica</option>
          <option>Austria</option>
          <option>Ireland</option>
          <option>India</option>
          <option>South Africa</option>
          <option>Italy</option>
          <option>Sweden</option>
          <option>Colombia</option>
          <option>Latvia</option>
          <option>Romania</option>
          <option>Belgium</option>
          <option>New Zealand</option>
          <option>Zimbabwe</option>
          <option>Spain</option>
          <option>Finland</option>
          <option>Uruguay</option>
          <option>Israel</option>
          <option>Bosnia and Herzegovina</option>
          <option>Hungary</option>
          <option>Singapore</option>
          <option>Japan</option>
          <option>Nigeria</option>
          <option>Croatia</option>
          <option>Norway</option>
          <option>Thailand</option>
          <option>Denmark</option>
          <option>The Bahamas</option>
          <option>Greece</option>
          <option>Moldova</option>
          <option>Georgia</option>
          <option>China</option>
          <option>Czech Republic</option>
          <option>Philippines</option>
        </select>
      </label>
    </div>

    <!-- Self-employed -->
    <div class="question">
      <label>Are you self-employed?
        <select name="self_employed" required>
          <option value="0">Yes</option>
          <option value="1">No</option>
        </select>
      </label>
    </div>

    <!-- Family history -->
    <div class="question">
      <label>Do you have a family history of mental illness?
        <select name="family_history" required>
          <option value="0">Yes</option>
          <option value="1">No</option>
        </select>
      </label>
    </div>

    <!-- Interferes with work -->
    <div class="question">
      <label>If you have a mental health condition, does it interfere with your work?
        <select name="work_interfere" required>
          <option value="0">Never</option>
          <option value="1">Sometimes</option>
          <option value="2">Often</option>
        </select>
      </label>
    </div>

    <!-- Number of employees -->
    <div class="question">
      <label>How many employees does your company have?
        <select name="no_employees" required>
          <option value="0">1-5</option>
          <option value="1">6-25</option>
          <option value="2">26-100</option>
          <option value="3">100-500</option>
          <option value="4">500-1000</option>
          <option value="5">More than 1000</option>
        </select>
      </label>
    </div>

    <div class="question">
      <label>Do you work remotely (outside of an office) at least 50% of the time?
        <select name="remote_work" required>
          <option value="0">Yes</option>
          <option value="1">No</option>
        </select>
      </label>
    </div>

    <div class="question">
      <label>Is your employer primarily a tech company/organization?
        <select name="tech_company" required>
          <option value="0">Yes</option>
          <option value="1">No</option>
        </select>
      </label>
    </div>

    <div class="question">
      <label> Does your employer provide mental health benefits?
        <select name="benefits" required>
          <option value="0">Yes</option>
          <option value="1">No</option>
          <option value="2">Don't know</option>
        </select>
      </label>
    </div>

    <div class="question">
      <label> Do you know the options for mental health care your employer provides?
        <select name="care_options" required>
          <option value="0">Yes</option>
          <option value="1">No</option>
          <option value="2">Not sure</option>
        </select>
      </label>
    </div>

    <div class="question">
      <label> Has your employer ever discussed mental health as part of an employee wellness program?
        <select name="wellness_program" required>
          <option value="0">Yes</option>
          <option value="1">No</option>
          <option value="2">Don't know</option>
        </select>
      </label>
    </div>

    <div class="question">
      <label> Does your employer provide resources to learn more about mental health issues and how to seek help?
        <select name="seek_help" required>
          <option value="0">Yes</option>
          <option value="1">No</option>
          <option value="2">Don't know</option>
        </select>
      </label>
    </div>


    <div class="question">
      <label> Is your anonymity protected if you choose to take advantage of mental health or substance abuse treatment resources?
        <select name="anonymity" required>
          <option value="0">Yes</option>
          <option value="1">No</option>
          <option value="2">Don't know</option>
        </select>
      </label>
    </div>

    <div class="question">
      <label>How easy is it for you to take medical leave for a mental health condition?
        <select name="leave" required>
          <option value="0">Very easy</option>
          <option value="1">Somewhat easy</option>
          <option value="2">Somewhat difficult</option>
          <option value="3">Very difficult</option>
          <option value="4">Don't know</option>
        </select>
      </label>
    </div>

    <div class="question">
      <label>Do you think that discussing a mental health issue with your employer would have negative consequences?
        <select name="mental_health_consequence" required>
          <option value="0">Yes</option>
          <option value="1">No</option>
          <option value="2">Maybe</option>
        </select>
      </label>
    </div>

    <div class="question">
      <label>Do you think that discussing a physical health issue with your employer would have negative consequences?
        <select name="phys_health_consequence" required>
          <option value="0">Yes</option>
          <option value="1">No</option>
          <option value="2">Maybe</option>
        </select>
      </label>
    </div>

    <div class="question">
      <label>Would you be willing to discuss a mental health issue with your coworkers?
        <select name="coworkers" required>
          <option value="0">Yes</option>
          <option value="1">No</option>
          <option value="2">Some of them</option>
        </select>
      </label>
    </div>

    <div class="question">
      <label>Would you be willing to discuss a mental health issue with your direct supervisor(s)?
        <select name="supervisor" required>
          <option value="0">Yes</option>
          <option value="1">No</option>
          <option value="2">Some of them</option>
        </select>
      </label>
    </div>

    <div class="question">
      <label>Would you bring up a mental health issue with a potential employer in an interview?
        <select name="mental_health_interview" required>
          <option value="0">Yes</option>
          <option value="1">No</option>
          <option value="2">Maybe</option>
        </select>
      </label>
    </div>

    <div class="question">
      <label>Would you bring up a physical health issue with a potential employer in an interview?
        <select name="phys_health_interview" required>
          <option value="0">Yes</option>
          <option value="1">No</option>
          <option value="2">Maybe</option>
        </select>
      </label>
    </div>

    <div class="question">
      <label>Do you feel that your employer takes mental health as seriously as physical health?
        <select name="mental_vs_physical" required>
          <option value="0">Yes</option>
          <option value="1">No</option>
          <option value="2">Don't know</option> <!-- fixed value -->
        </select>
      </label>
    </div>

    <div class="question">
      <label>Have you heard of or observed negative consequences for coworkers with mental health conditions in your workplace?
        <select name="obs_consequence" required>
          <option value="0">Yes</option>
          <option value="1">No</option>
        </select>
      </label>
    </div>

    <div style="margin-top: 20px;">
      <button type="button" id="prevBtn" onclick="prevQuestion()">Previous</button>
      <button type="button" id="nextBtn" onclick="nextQuestion()">Next</button>
      <button type="submit" id="submitBtn" style="display:none;">Submit</button>
    </div>
  </form>

  <div id="result" style="margin-top: 30px; font-weight: bold;"></div>

  <script>
  // Navigation logic
  let currentQuestion = 0;
  const questions = document.querySelectorAll(".question");
  const nextBtn = document.getElementById("nextBtn");
  const prevBtn = document.getElementById("prevBtn");
  const submitBtn = document.getElementById("submitBtn");

  function showQuestion(index) {
    questions.forEach((q, i) => q.classList.toggle("active", i === index));
    prevBtn.style.display = index === 0 ? "none" : "inline-block";
    nextBtn.style.display = index === questions.length - 1 ? "none" : "inline-block";
    submitBtn.style.display = index === questions.length - 1 ? "inline-block" : "none";
  }

  function nextQuestion() {
    const currentInputs = questions[currentQuestion].querySelectorAll("input, select, textarea");
    for (const el of currentInputs) {
      if (el.hasAttribute("required") && !el.value) {
        alert("Please answer the question before continuing.");
        return;
      }
    }
    if (currentQuestion < questions.length - 1) {
      currentQuestion++;
      showQuestion(currentQuestion);
    }
  }

  function prevQuestion() {
    if (currentQuestion > 0) {
      currentQuestion--;
      showQuestion(currentQuestion);
    }
  }

  // Handle form submission
  document.getElementById("predictionForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const formData = new FormData(e.target);
    const jsonData = {};
    for (const [key, value] of formData.entries()) {
      if (key === "country") {
        jsonData["Country"] = value; // FIXED key name for backend
      } else {
        jsonData[key] = isNaN(value) ? value : Number(value);
      }
    }

    console.log("Payload to send:", jsonData);

    const expectedKeys = [
      "age","gender","Country","self_employed","family_history","work_interfere","no_employees",
      "remote_work","tech_company","benefits","care_options","wellness_program","seek_help",
      "anonymity","leave","mental_health_consequence","phys_health_consequence","coworkers",
      "supervisor","mental_health_interview","phys_health_interview","mental_vs_physical","obs_consequence"
    ];
    for (const k of expectedKeys) {
      if (!(k in jsonData)) {
        document.getElementById("result").innerText = `Missing field: ${k}`;
        return;
      }
    }

    try {
      const response = await fetch("http://127.0.0.1:8000/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(jsonData)
      });

      const data = await response.json();
      console.log("Server response:", data);

      if (response.ok && data.prediction !== undefined) {
        let message = "";
        if (data.prediction === 0) {
          message = "✅ You are mentally fit";
        } else if (data.prediction === 1) {
          message = "⚠️ You need a mental health checkup";
        } else {
          message = `Unexpected prediction value: ${data.prediction}`;
        }
        document.getElementById("result").innerText = message;
      } else if (data.error) {
        document.getElementById("result").innerText = "Error: " + data.error;
      } else {
        document.getElementById("result").innerText = "Unexpected response format.";
        console.log("Raw response:", data);
      }
    } catch (err) {
      console.error("Fetch error:", err);
      document.getElementById("result").innerText = "Server error: " + err.message;
    }
  });

  // Initialize UI
  showQuestion(currentQuestion);
</script>
